<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Farmerâ€™s Market Vendor Directory Builder</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Grab a fun, farmâ€‘friendly font stack -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Comfortaa:wght@300..700&family=Lora:ital,wght@0,400..700;1,400..700&family=Oswald:wght@300;400;500;600;700&family=Pacifico&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #fff9f1;          /* paper */
      --panel: #ffffff;       /* card */
      --ink: #1a1a1a;         /* main text */
      --muted: #5a5a5a;       /* secondary */
      --brand: #2b8a3e;       /* green */
      --accent: #f59f00;      /* ochre */
      --accent-2: #d9480f;    /* tomato */
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --font-body: "Lora", serif;
      --font-display: "Bebas Neue", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --font-alt: "Comfortaa", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    html,body{height:100%}
    body{
      margin:0; background: var(--bg); color: var(--ink);
      font-family: var(--font-body); line-height: 1.5;
      /* Subtle farm pattern */
      --g: 16px; --c1: #fff4e6; --c2:#fefcf8;
      background-image:
        radial-gradient(circle at 20px 20px, rgba(43,138,62,.05) 2px, transparent 2px),
        radial-gradient(circle at 60px 40px, rgba(249,159,0,.06) 3px, transparent 3px),
        linear-gradient(0deg, var(--c2), var(--c2));
      background-size: 80px 80px, 120px 120px, auto;
    }
    .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px}
    .badge{background:var(--panel);box-shadow:var(--shadow);border-radius:999px;padding:8px 14px;font-family:var(--font-alt);font-weight:700;letter-spacing:.3px}
    .title{
      font-family: var(--font-display); font-size: clamp(36px, 6vw, 72px); letter-spacing:1px;
      line-height:1; margin:0; text-transform:uppercase;
      display:flex; align-items:center; gap:12px
    }
    .title .emoji{font-size: .9em}

    .panel{background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width: 900px){ .grid{grid-template-columns: 1.1fr .9fr} }
    .subgrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .subgrid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    label{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.12em}
    input, select, textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #ddd;outline:none;font:inherit;background:#fff}
    textarea{min-height:70px;resize:vertical}
    .btn{appearance:none;border:0;padding:12px 16px;border-radius:14px;background:var(--ink);color:#fff;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn.ghost{background:transparent;color:var(--ink);border:2px solid var(--ink)}
    .btn.green{background:var(--brand)}
    .btn.orange{background:var(--accent)}

    .vendor{display:grid;grid-template-columns: 96px 1fr;gap:14px;align-items:center;padding:14px;border:1px dashed #e6e2da;border-radius:14px;background:#fffdf9}
    .vendor .img{width:96px;height:96px;border-radius:12px;background:#f2f2f2;display:grid;place-items:center;overflow:hidden}
    .vendor .img img{width:100%;height:100%;object-fit:cover}
    .vendor h4{margin:0;font-family:var(--font-display);letter-spacing:.6px}
    .vendor .meta{font-size:13px;color:var(--muted)}
    .vendor .desc{font-size:14px;margin-top:6px}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap}
    .pill{padding:8px 12px;border-radius:999px;background:#fff;border:1px solid #e6e6e6;font-size:13px;cursor:pointer}
    .pill[data-active="true"]{background:var(--ink);color:#fff}

    /* Directory view */
    .hero{position:relative;overflow:hidden;border-radius:24px;background:linear-gradient(135deg, rgba(43,138,62,.12), rgba(245,159,0,.12)), #ffffff;border:1px solid #f0eadf}
    .hero-inner{display:grid;grid-template-columns: 1.2fr .8fr;gap:16px;align-items:center;padding:22px}
    .hero h1{font-family: var(--font-display); font-size: clamp(40px,5.4vw,86px); line-height:.95; margin:0; text-transform:uppercase}
    .hero p{margin:.25rem 0 0 0; color:var(--muted)}
    .hero .art{height:100%;min-height:160px}

    .cards{display:grid;grid-template-columns: repeat(auto-fill, minmax(260px,1fr)); gap:16px}
    .card{background:#fff;border-radius:18px;overflow:hidden;box-shadow:var(--shadow);display:flex;flex-direction:column;border:1px solid #f2eee6}
    .card .cover{height:160px;background:#f4f6f2;display:grid;place-items:center}
    .card .cover img{width:100%;height:100%;object-fit:cover}
    .card .body{padding:14px 14px 16px}
    .card h3{margin:0 0 6px 0; font-family: var(--font-display);letter-spacing:.6px}
    .card .tag{display:inline-block;padding:6px 10px;border-radius:999px;background: #ecf7ef; color:#25622f; font-weight:700; font-size:12px; letter-spacing:.08em; text-transform:uppercase}

    .footer-note{color:var(--muted);font-size:13px;text-align:center;margin-top:20px}

    .section-title{font-family:var(--font-display); letter-spacing:.6px; text-transform:uppercase; font-size: clamp(22px, 2.6vw, 32px); margin: 10px 0}

    /* Tiny farm SVG accents */
    .corn{position:absolute; right:-30px; bottom:-30px; width:220px; opacity:.25}
    .tractor{position:absolute; left:-20px; top:-20px; width:120px; opacity:.18}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <h1 class="title"><span class="emoji">ðŸŒ½</span> Vendor Directory Builder <span class="emoji">ðŸšœ</span></h1>
      <span class="badge">linkâ€‘share ready â€¢ images by URL only</span>
    </div>

    <!-- Builder Panel (hidden in view mode) -->
    <div id="builder" class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:8px">
        <h2 class="section-title" style="margin:0">Build Your Market</h2>
        <div class="toolbar">
          <button class="btn green" id="btn-preview">Preview</button>
          <button class="btn" id="btn-generate">Get Share Link</button>
          <button class="btn orange" id="btn-reset">Reset</button>
        </div>
      </div>

      <div class="grid">
        <div class="left">
          <div class="subgrid">
            <div>
              <label>Market Name</label>
              <input id="marketName" placeholder="Twin Oaks Saturday Market" />
            </div>
            <div>
              <label>Date or Season</label>
              <input id="marketDate" placeholder="Saturdays, May â€“ Oct â€¢ 8amâ€“1pm" />
            </div>
          </div>
          <div class="subgrid">
            <div>
              <label>Location</label>
              <input id="marketLocation" placeholder="Town Square, 123 Main St" />
            </div>
            <div>
              <label>Contact / Website</label>
              <input id="marketContact" placeholder="twinoaksmarket.org" />
            </div>
          </div>

          <div class="subgrid-3">
            <div>
              <label>Theme Color</label>
              <input id="colorBrand" type="color" value="#2b8a3e" />
            </div>
            <div>
              <label>Accent Color</label>
              <input id="colorAccent" type="color" value="#f59f00" />
            </div>
            <div>
              <label>Tomato (2nd Accent)</label>
              <input id="colorAccent2" type="color" value="#d9480f" />
            </div>
          </div>

          <div class="subgrid">
            <div>
              <label>Display Font</label>
              <select id="fontDisplay">
                <option value="Bebas Neue">Bebas Neue (bold uppercase)</option>
                <option value="Pacifico">Pacifico (handâ€‘lettered)</option>
                <option value="Oswald">Oswald (condensed)</option>
              </select>
            </div>
            <div>
              <label>Body Font</label>
              <select id="fontBody">
                <option value="Lora">Lora (serif)</option>
                <option value="Comfortaa">Comfortaa (rounded)</option>
                <option value="Oswald">Oswald</option>
              </select>
            </div>
          </div>

          <div style="margin-top:8px">
            <label>About This Market (optional)</label>
            <textarea id="marketAbout" placeholder="Fresh produce, artisan breads, pastureâ€‘raised meats, and good vibes."></textarea>
          </div>
        </div>

        <div class="right">
          <h3 class="section-title" style="margin-top:0">Vendors</h3>
          <div id="vendors"></div>
          <div style="display:flex; gap:10px; margin-top:12px">
            <button id="addVendor" class="btn">+ Add Vendor</button>
            <button id="sampleVendors" class="btn ghost">Load Sample</button>
          </div>
          <p class="footer-note">Images are by link only. Use direct image URLs (jpg/png/webp) â€” no uploads.</p>
        </div>
      </div>
    </div>

    <!-- Directory View (hidden until preview or query param present) -->
    <div id="view" style="display:none">
      <div class="hero">
        <svg class="tractor" viewBox="0 0 256 256" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden>
          <path d="M30 170h196" stroke="currentColor" stroke-width="6" opacity=".2"/>
          <circle cx="190" cy="180" r="40" stroke="currentColor" stroke-width="10" opacity=".25"/>
          <circle cx="78" cy="188" r="30" stroke="currentColor" stroke-width="8" opacity=".25"/>
        </svg>
        <svg class="corn" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-hidden>
          <g opacity=".9">
            <ellipse cx="100" cy="100" rx="26" ry="70" fill="var(--accent)"/>
            <path d="M100 40c-30 10-60 55-58 94 28-22 46-22 58-20 12-2 30-2 58 20 2-39-28-84-58-94Z" fill="var(--brand)"/>
          </g>
        </svg>
        <div class="hero-inner">
          <div>
            <h1 id="v-name">Your Market</h1>
            <p id="v-date">Saturdays, 8â€“1</p>
            <p id="v-location">Town Square</p>
            <p id="v-contact" style="margin-bottom:0"></p>
          </div>
          <div class="art">
            <svg viewBox="0 0 400 200" width="100%" height="100%" preserveAspectRatio="xMidYMid meet">
              <defs>
                <linearGradient id="sun" x1="0" x2="0" y1="0" y2="1">
                  <stop offset="0%" stop-color="var(--accent)" />
                  <stop offset="100%" stop-color="#ffdca8" />
                </linearGradient>
              </defs>
              <circle cx="70" cy="60" r="38" fill="url(#sun)" opacity=".9" />
              <path d="M0 150 C80 120, 140 180, 220 150 S340 160, 400 140 L400 200 L0 200 Z" fill="var(--brand)" opacity=".18"/>
              <path d="M0 170 C80 140, 140 200, 220 170 S340 180, 400 160 L400 200 L0 200 Z" fill="var(--accent)" opacity=".12"/>
            </svg>
          </div>
        </div>
      </div>

      <h2 class="section-title">Vendors</h2>
      <div id="cardGrid" class="cards"></div>
      <p class="footer-note" id="v-about"></p>
    </div>
  </div>

  <!-- LZâ€‘String for compact, shareable URLs -->
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>
  <script>
    const $ = sel => document.querySelector(sel);
    const vendorsEl = $('#vendors');

    const state = {
      market: {
        name: '', date: '', location: '', contact: '', about: '',
        colors: { brand: '#2b8a3e', accent: '#f59f00', accent2: '#d9480f' },
        fonts: { display: 'Bebas Neue', body: 'Lora' }
      },
      vendors: []
    };

    function applyTheme() {
      document.documentElement.style.setProperty('--brand', state.market.colors.brand);
      document.documentElement.style.setProperty('--accent', state.market.colors.accent);
      document.documentElement.style.setProperty('--accent-2', state.market.colors.accent2);
      document.documentElement.style.setProperty('--font-display', `'${state.market.fonts.display}', var(--font-display)`);
      document.documentElement.style.setProperty('--font-body', `'${state.market.fonts.body}', var(--font-body)`);
    }

    function vendorRow(v, idx){
      const wrap = document.createElement('div');
      wrap.className = 'vendor';
      wrap.innerHTML = `
        <div class="img">${v.img ? `<img src="${v.img}" alt="${v.name}">` : 'ðŸ§º'}</div>
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
            <h4 contenteditable="true" data-k="name">${v.name || 'New Vendor'}</h4>
            <div style="display:flex;gap:6px">
              <button class="pill" data-action="up">â†‘</button>
              <button class="pill" data-action="down">â†“</button>
              <button class="pill" data-action="delete">Remove</button>
            </div>
          </div>
          <div class="subgrid">
            <div>
              <label>Category</label>
              <input value="${v.category||''}" data-k="category" placeholder="Produce / Bakery / Flowers / Meats / Crafts" />
            </div>
            <div>
              <label>Image URL (link only)</label>
              <input value="${v.img||''}" data-k="img" placeholder="https://.../photo.jpg" />
            </div>
          </div>
          <div class="subgrid">
            <div>
              <label>Website (optional)</label>
              <input value="${v.url||''}" data-k="url" placeholder="https://vendor-site.com" />
            </div>
            <div>
              <label>Phone / Contact</label>
              <input value="${v.contact||''}" data-k="contact" placeholder="(555) 123â€‘4567" />
            </div>
          </div>
          <div style="margin-top:6px">
            <label>Description</label>
            <textarea data-k="desc" placeholder="What do they sell? Short + punchy.">${v.desc||''}</textarea>
          </div>
        </div>`;

      // listeners
      wrap.querySelectorAll('input, textarea').forEach(inp=>{
        inp.addEventListener('input', e=>{
          const key = e.target.getAttribute('data-k');
          state.vendors[idx][key] = e.target.value;
          renderCards();
        })
      });
      wrap.querySelector('h4').addEventListener('input', e=>{
        state.vendors[idx].name = e.target.textContent.trim();
        renderCards();
      });
      wrap.querySelectorAll('[data-action]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const a = btn.getAttribute('data-action');
          if(a==='delete'){ state.vendors.splice(idx,1); buildVendors(); renderCards(); }
          if(a==='up' && idx>0){ const t = state.vendors[idx-1]; state.vendors[idx-1]=state.vendors[idx]; state.vendors[idx]=t; buildVendors(); renderCards(); }
          if(a==='down' && idx<state.vendors.length-1){ const t = state.vendors[idx+1]; state.vendors[idx+1]=state.vendors[idx]; state.vendors[idx]=t; buildVendors(); renderCards(); }
        })
      })
      return wrap;
    }

    function buildVendors(){
      vendorsEl.innerHTML='';
      state.vendors.forEach((v,i)=> vendorsEl.appendChild(vendorRow(v,i)));
    }

    function renderCards(){
      // liveâ€‘preview in view panel if it's open
      const grid = $('#cardGrid'); if(!grid) return;
      grid.innerHTML='';
      state.vendors.forEach(v=>{
        const card = document.createElement('div');
        card.className='card';
        const hasImg = !!(v.img && v.img.trim());
        card.innerHTML = `
          <div class="cover">${hasImg ? `<img loading="lazy" src="${v.img}" alt="${v.name}">` : 'ðŸ§º'}</div>
          <div class="body">
            <div style="display:flex;justify-content:space-between;align-items:center;gap:10px">
              <h3>${v.name||'Vendor'}</h3>
              ${v.category ? `<span class="tag">${v.category}</span>` : ''}
            </div>
            ${v.desc ? `<p class="desc">${v.desc}</p>` : ''}
            <div class="meta">
              ${v.url ? `<a href="${v.url}" target="_blank" rel="noopener" style="text-decoration:none">ðŸ”— ${v.url.replace(/^https?:\/\//,'')}</a>` : ''}
              ${v.contact ? `${v.url ? ' â€¢ ' : ''}ðŸ“ž ${v.contact}` : ''}
            </div>
          </div>`;
        grid.appendChild(card);
      })

      $('#v-name').textContent = state.market.name || 'Your Market';
      $('#v-date').textContent = state.market.date || 'Saturdays, 8â€“1';
      $('#v-location').textContent = state.market.location || 'Town Square';
      $('#v-contact').textContent = state.market.contact || '';
      $('#v-about').textContent = state.market.about || '';
      applyTheme();
    }

    function readMarketInputs(){
      state.market.name = $('#marketName').value.trim();
      state.market.date = $('#marketDate').value.trim();
      state.market.location = $('#marketLocation').value.trim();
      state.market.contact = $('#marketContact').value.trim();
      state.market.about = $('#marketAbout').value.trim();
      state.market.colors.brand = $('#colorBrand').value;
      state.market.colors.accent = $('#colorAccent').value;
      state.market.colors.accent2 = $('#colorAccent2').value;
      state.market.fonts.display = $('#fontDisplay').value;
      state.market.fonts.body = $('#fontBody').value;
    }

    function encodeState(){
      const json = JSON.stringify(state);
      return LZString.compressToEncodedURIComponent(json);
    }
    function decodeState(s){
      try{
        const json = LZString.decompressFromEncodedURIComponent(s);
        return JSON.parse(json);
      }catch(e){ return null }
    }

    function openPreview(){
      readMarketInputs();
      $('#builder').style.display='none';
      $('#view').style.display='block';
      renderCards();
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function openBuilder(){
      $('#builder').style.display='block';
      $('#view').style.display='none';
    }

    $('#btn-preview').addEventListener('click', openPreview);
    $('#btn-generate').addEventListener('click', ()=>{
      readMarketInputs();
      const d = encodeState();
      const base = window.location.origin + window.location.pathname;
      const url = `${base}?d=${d}#view`;
      navigator.clipboard.writeText(url).catch(()=>{});
      alert('Share link is copied to your clipboard.\n\nAnyone with the link can view this directory.');
      // Also switch to preview so they can see it
      openPreview();
      history.replaceState(null, '', `?d=${d}#view`);
    });

    $('#btn-reset').addEventListener('click', ()=>{
      if(confirm('Start over?')){ state.vendors = []; buildVendors(); renderCards(); }
    })

    $('#addVendor').addEventListener('click', ()=>{
      state.vendors.push({ name:'New Vendor', category:'', desc:'', url:'', contact:'', img:'' });
      buildVendors();
    })

    $('#sampleVendors').addEventListener('click', ()=>{
      state.vendors = [
        { name:'Sunup Produce Co.', category:'Vegetables', desc:'Heritage tomatoes, sweet corn, cucumbers, and greens picked at dawn.', url:'https://example.com', contact:'(555) 212â€‘0001', img:'https://images.unsplash.com/photo-1437750769465-301382cdf094?q=80&w=1200&auto=format&fit=crop' },
        { name:'Crust & Crumb Bakery', category:'Bakery', desc:'Naturally leavened sourdough, pretzels, and fruit galettes.', url:'', contact:'', img:'https://images.unsplash.com/photo-1541782814456-3f420e42e7e0?q=80&w=1200&auto=format&fit=crop' },
        { name:'Prairie Flowers', category:'Flowers', desc:'Seasonal bouquets, dahlias & sunflowers from pesticideâ€‘free fields.', url:'', contact:'', img:'https://images.unsplash.com/photo-1438109491414-7198515b166b?q=80&w=1200&auto=format&fit=crop' },
        { name:'Maple Ridge Farm', category:'Meats', desc:'Grassâ€‘fed beef and pastureâ€‘raised pork. Ask about bundles.', url:'', contact:'', img:'https://images.unsplash.com/photo-1544025162-d76694265947?q=80&w=1200&auto=format&fit=crop' },
      ];
      buildVendors();
      renderCards();
    })

    // Wire up market input live preview
    ['#marketName','#marketDate','#marketLocation','#marketContact','#marketAbout','#colorBrand','#colorAccent','#colorAccent2','#fontDisplay','#fontBody']
      .forEach(sel=> $(sel).addEventListener('input', ()=>{ readMarketInputs(); renderCards(); }));

    // If we have a query param ?d=... show view directly
    function initFromQuery(){
      const url = new URL(window.location.href);
      const d = url.searchParams.get('d');
      if(d){
        const obj = decodeState(d);
        if(obj){
          Object.assign(state, obj);
          applyTheme();
          openPreview();
          buildVendors();
          renderCards();
          return true;
        }
      }
      return false;
    }

    // Startup
    const fromLink = initFromQuery();
    if(!fromLink){
      // seed with 1 empty vendor so UI isnâ€™t blank
      state.vendors.push({ name:'New Vendor', category:'', desc:'', url:'', contact:'', img:'' });
      buildVendors();
      renderCards();
    }
  </script>
</body>
</html>
